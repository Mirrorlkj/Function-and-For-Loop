---
title: "Exploring World Bank Data"
author: "Kejing Li"
output: github_document
---

## Load necessary libraries

```{r}
library(tidyverse)
```

## Write a function to import the data files

```{r}
read_and_tidy <- function(path) {
  data <- read.csv(path, skip = 4) %>%
  select(-Country.Code, -Indicator.Name)%>%
  filter(Indicator.Code %in% c("IC.FRM.FEMO.ZS",
                               "IC.FRM.FEMM.ZS",
                               "IC.REG.PROC.FE",
                               "TX.VAL.TECH.MF.ZS"))%>%
     
    pivot_longer(-c("Country.Name",
                    "Indicator.Code"),
                 names_to = "Year",
                 values_to = "Value",
                 names_prefix = "X") %>%
    pivot_wider(names_from = "Indicator.Code",
                values_from = "Value") %>%
    rename(hitech_export = TX.VAL.TECH.MF.ZS,
           female_register_procedure = IC.REG.PROC.FE,
           female_ownership_participation = IC.FRM.FEMO.ZS,
           female_top_management = IC.FRM.FEMM.ZS)
  return(data)     
}
```

## Import the data


```{r, warning=FALSE }
directory <- dir(path = "data_world_bank", full.names = TRUE)
data <- data.frame()
for (i in seq_along(directory)){
  data <- bind_rows(data, read_and_tidy(directory[i]))
}

```

## Explore the data

### Firms with female participation in ownership by year
```{r}
data %>%
  drop_na(female_ownership_participation)%>%
  ggplot()+
  geom_boxplot(aes(Year,female_ownership_participation))+
  labs(title = "Firms with female participation in ownership",
        x = "Year",
        y = "% of firms")
```


###  Firms with female top manager by year
```{r}
data %>%
  drop_na(female_top_management)%>%
  group_by(Year) %>%
  summarize(female_top_management = mean(female_top_management)) %>%
  ggplot()+
  geom_col(aes(Year, female_top_management))+
  labs(title = "Firms with female top manager",
        x = "Year",
        y = "% of firms")
```

### Covariance of female participation in ownership and female top manager

```{r}
data%>%
  drop_na(female_ownership_participation, female_top_management) %>%
  group_by(Country.Name)%>%
  ggplot()+
  geom_smooth(aes(female_top_management,female_ownership_participation))+
labs(title = "Relationship between female participation in ownership and female top manager",
        x = "Female top manager",
        y = "Female participation in ownership")

```

### Covariance of Start-up procedures to register a business(female) and female top manager
```{r}
data%>%
  drop_na(female_register_procedure, female_top_management) %>%
  group_by(Country.Name)%>%
  ggplot()+
  scale_x_continuous(limits = c(0, 15))+
  geom_boxplot(aes(female_register_procedure, female_top_management,
                  group = cut_width(female_register_procedure, 2)))
```


### Covariance of High-technology exports and female top manager
```{r}
data%>%
  drop_na(hitech_export, female_top_management) %>%
  group_by(Country.Name)%>%
  ggplot(aes(hitech_export, female_top_management))+
  geom_point(alpha = 1/2)+
  geom_smooth()
```


## Session info

```{r}
devtools::session_info()
```


